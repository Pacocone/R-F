<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>RestaurantWorld App Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #181818; font-family: Arial, sans-serif; margin: 0; }
    .container { max-width: 430px; margin: 0 auto; background: #222; padding: 8px; border-radius: 16px; box-shadow: 0 4px 16px #111; color: #fff; }
    .tabs { display: flex; border-bottom: 2px solid #444; margin-bottom: 16px; gap: 4px; }
    .tab { flex: 1; padding: 10px 0; text-align: center; cursor: pointer; font-weight: bold; font-size: 1em; letter-spacing: 1px; color: #bbb; background: none; border: none; transition: color 0.2s; }
    .tab.active { color: #00eaff; border-bottom: 4px solid #00eaff; background: #181818; }
    .hidden { display: none; }
    h2 { text-align: center; margin-top: 0; font-size: 1.2em; color: #00eaff; letter-spacing: 1px; }
    .card { background: #282828; border-radius: 12px; box-shadow: 0 2px 8px #111; padding: 10px; margin-bottom: 12px; color: #fff; }
    .stars { color: #ffd700; font-size: 1.1em; cursor: pointer; }
    .btn { background: linear-gradient(90deg,#00eaff,#0056b3); color: #fff; border: none; padding: 10px 0; border-radius: 8px; cursor: pointer; margin-top: 8px; font-size: 1em; font-weight: bold; letter-spacing: 1px; width: 100%; box-shadow: 0 2px 8px #0056b3; }
    .btn:active { background: linear-gradient(90deg,#0056b3,#00eaff); }
    select, input, textarea { margin: 4px 0 8px 0; padding: 8px; border-radius: 6px; border: 1px solid #444; width: 100%; background: #181818; color: #fff; font-size: 1em; }
    label { font-weight: bold; color: #00eaff; }
    .flex-row { display: flex; gap: 4px; }
    .img-preview { width: 100px; height: 100px; object-fit: contain; margin-top: 6px; border: 1px solid #444; border-radius: 8px; background: #222; }
    .review-list { margin: 4px 0 0 12px; }
    .lang-theme { display: flex; gap: 8px; margin-bottom: 10px; align-items: center; }
    .lang-theme select { width: 60%; }
    .lang-icon, .theme-icon { width: 24px; height: 24px; vertical-align: middle; margin-right: 4px; }
    .tab, .btn { text-shadow: 0 2px 8px #0056b3; }
    option { background: #181818; color: #fff; }
    ::placeholder { color: #bbb; }
    .restaurante-nombre { color: #00eaff; font-weight: bold; font-size: 1em; letter-spacing: 1px; }
    .explorar-controls { margin-bottom: 10px; display: flex; flex-direction: column; gap: 4px; }
    .usuario-nombre { color: #ffd700; font-weight: bold; }
    .tab-content { margin-bottom: 16px; }
    .delete-btn { background: none; border: none; cursor: pointer; width: 32px; height: 32px; margin-top: 4px; display: flex; align-items: center; justify-content: center; }
    .delete-btn img { width: 20px; height: 20px; }
    @media (max-width: 600px) {
      .container { max-width: 98vw; padding: 2vw; }
      h2 { font-size: 1em; }
      .card { padding: 6px; }
      .img-preview { width: 70px; height: 70px; }
      .tab { font-size: 0.9em; }
      label, select, input, textarea { font-size: 0.95em; }
    }
    body.light-mode { background: #f9f9f9; }
    .container.light-mode { background: #fff; color: #222; }
    .light-mode select, .light-mode input, .light-mode textarea { background: #fff !important; color: #222 !important; border: 1px solid #bbb; }
    .light-mode .tab { color: #222; }
    .light-mode .tab.active { color: #0056b3; border-bottom: 4px solid #0056b3; background: #fff; }
    .light-mode .card { background: #f5f5f5; color: #222; }
    .light-mode label { color: #0056b3; }
    .light-mode .restaurante-nombre { color: #0056b3; }
  </style>
</head>
<!-- Modal para mostrar ticket -->
<div id="ticketModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:9999; align-items:center; justify-content:center;">
  <div style="background:#fff; border-radius:12px; padding:16px; max-width:90vw; max-height:90vh; margin:auto; display:flex; flex-direction:column; align-items:center;">
    <img id="ticketImg" src="" style="max-width:80vw; max-height:70vh; border-radius:8px;">
    <button class="btn" onclick="document.getElementById('ticketModal').style.display='none';" style="margin-top:12px;">Cerrar</button>
  </div>
</div>
<body>
<!-- Ventana de registro modal dark -->
<div id="registroModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:9999; align-items:center; justify-content:center;">
  <div style="background:#222; color:#fff; border-radius:12px; padding:24px; max-width:340px; margin:auto; box-shadow:0 4px 16px #111;">
    <h2 style="color:#00eaff;">Registro de usuario</h2>
    <form id="registroForm" autocomplete="off">
      <label style="color:#00eaff;">Email:</label>
      <input type="email" id="regEmail" required style="background:#181818; color:#fff; border:1px solid #444;">
      <label style="color:#00eaff;">ContraseÃ±a:</label>
      <input type="password" id="regPassword" required style="background:#181818; color:#fff; border:1px solid #444;">
      <label style="color:#00eaff;">Nombre de usuario:</label>
      <input type="text" id="regUsername" required style="background:#181818; color:#fff; border:1px solid #444;">
      <button type="submit" class="btn" style="margin-top:12px;">Registrarse</button>
    </form>
    <div id="regMsg" style="margin-top:8px;"></div>
  </div>
</div>
<div class="container" id="mainContainer">
<!-- Modern header for app -->
<div style="text-align:center; margin-bottom:18px;">
  <span style="font-size:2.7em; font-family:'Segoe UI',Arial,sans-serif; font-weight:900; font-style:italic; letter-spacing:0.08em; color:#00eaff; text-shadow:0 2px 12px #0056b3,0 0 2px #fff;">
    R&amp;F
  </span>
  <br>
  <span style="font-size:1.1em; font-family:'Montserrat',Arial,sans-serif; font-weight:600; font-style:italic; letter-spacing:0.12em; color:#ffd700; text-shadow:0 1px 8px #222;">
    Restaurants and Friends
  </span>
</div>
  <div class="lang-theme">
    <span>
      <img class="lang-icon" id="langLogo" src="https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f1ea-1f1f8.svg" alt="ES">
      <select id="lang"></select>
    </span>
 <span>
  <img class="theme-icon" id="themeLogo" src="https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f31e.svg" alt="Light">
  <select id="theme">
    <option value="light">Claro</option>
    <option value="dark">Oscuro</option>
  </select>
</span>  
  </div>
  <div class="tabs">
  <button class="tab active" id="tabBtn0"></button>
  <button class="tab" id="tabBtn1"></button>
  <button class="tab" id="tabBtn2"></button>
  <button class="tab" id="tabBtn3"></button>
  <button class="tab" id="tabBtn4"></button>
</div>
<!-- AÃ±adir Visita -->
<div id="tab0" class="tab-content">
  <h2 id="addTitle"></h2>
  <form id="visitForm" autocomplete="off">
    <label id="lblRestaurante"></label>
    <input type="text" id="restaurante" list="restauranteList" placeholder="">
    <datalist id="restauranteList"></datalist>
    <label id="lblFecha"></label>
    <input type="date" id="fecha">
    <label id="lblCiudad"></label>
    <input type="text" id="ciudadInput" list="ciudadList" placeholder="">
    <datalist id="ciudadList"></datalist>
    <label id="lblPais"></label>
    <input type="text" id="paisInput" list="paisList" placeholder="">
    <datalist id="paisList"></datalist>
    <label id="lblComensales"></label>
    <input type="number" id="comensales" min="1" value="" placeholder="">
    <label id="lblTotal"></label>
    <div class="flex-row">
      <input type="number" id="total" min="0" step="0.01">
      <select id="moneda"></select>
    </div>
    <label id="lblAvgPrice"></label>
    <input type="text" id="avgPrice" readonly>
    <label id="lblValoracion"></label>
    <div id="stars">
      <span class="stars" data-star="1">â˜…</span>
      <span class="stars" data-star="2">â˜…</span>
      <span class="stars" data-star="3">â˜…</span>
      <span class="stars" data-star="4">â˜…</span>
      <span class="stars" data-star="5">â˜…</span>
    </div>
    <input type="hidden" id="valoracion" value="0">
    <label id="lblReseÃ±a"></label>
    <textarea id="reseÃ±a" placeholder=""></textarea>
    <label id="lblTicket"></label>
    <input type="file" id="ticket" accept="image/*" capture="environment">
    <img id="ticketPreview" class="img-preview" style="display:none;">
    <button type="submit" class="btn" id="btnGuardar"></button>
  </form>
  <div id="visitMsg"></div>
</div>
<!-- Resumen -->
<div id="tab1" class="tab-content hidden">
  <h2 id="resumenTitle"></h2>
  <label for="year" id="lblYear"></label>
  <select id="year"></select>
  <label id="lblResumenRest"></label>
  <select id="resumenRest"></select>
  <label id="lblResumenPais"></label>
  <select id="resumenPais"></select>
  <label id="lblResumenCiudad"></label>
  <select id="resumenCiudad"></select>
  <div id="totalGastado" style="margin: 8px 0; font-weight: bold;"></div>
  <div id="resumenCards"></div>
</div>
<!-- Historial -->
<div id="tab2" class="tab-content hidden">
  <h2 id="historialTitle"></h2>
  <label id="lblHistRest"></label>
  <select id="histRest"></select>
  <label id="lblHistPais"></label>
  <select id="histPais"></select>
  <label id="lblHistCiudad"></label>
  <select id="histCiudad"></select>
  <div id="historialCards"></div>
</div>
<!-- Explorar -->
<div id="tab3" class="tab-content hidden">
  <h2 id="explorarTitle"></h2>
  <div class="explorar-controls">
    <label id="lblExpPais"></label>
    <select id="explorarPais"></select>
    <label id="lblExpCiudad"></label>
    <select id="explorarCiudad"></select>
    <label id="lblExpRest"></label>
    <select id="explorarRestaurante"></select>
    <label id="lblExpUsuario"></label>
    <select id="explorarUsuario"></select>
  </div>
  <div id="explorarCards"></div>
</div>
<!-- AMIGOS -->
<div id="tab4" class="tab-content hidden">
  <h2 id="amigosTitle"></h2>
  <label id="lblAmigosPais"></label>
  <select id="amigosPais"></select>
  <label id="lblAmigosCiudad"></label>
  <select id="amigosCiudad"></select>
  <label id="lblAmigosUsuario"></label>
  <select id="amigosUsuario"></select>
  <div id="amigosCards"></div>
</div>
<script>
  // Mapeos de paÃ­ses y ciudades para traducciÃ³n
const countryMap = {
  'spain': { es: 'EspaÃ±a', en: 'Spain', fr: 'Espagne', de: 'Spanien', ar: 'Ø¥Ø³Ø¨Ø§Ù†ÙŠØ§', zh: 'è¥¿ç­ç‰™' },
  'france': { es: 'Francia', en: 'France', fr: 'France', de: 'Frankreich', ar: 'ÙØ±Ù†Ø³Ø§', zh: 'æ³•å›½' },
  'italy': { es: 'Italia', en: 'Italy', fr: 'Italie', de: 'Italien', ar: 'Ø¥ÙŠØ·Ø§Ù„ÙŠØ§', zh: 'æ„å¤§åˆ©' },
  'england': { es: 'Inglaterra', en: 'England', fr: 'Angleterre', de: 'England', ar: 'Ø¥Ù†Ø¬Ù„ØªØ±Ø§', zh: 'è‹±æ ¼å…°' },
  'great britain': { es: 'Reino Unido', en: 'Great Britain', fr: 'Grande-Bretagne', de: 'GroÃŸbritannien', ar: 'Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠØ§ Ø§Ù„Ø¹Ø¸Ù…Ù‰', zh: 'å¤§ä¸åˆ—é¢ ' },
  'united kingdom': { es: 'Reino Unido', en: 'United Kingdom', fr: 'Royaume-Uni', de: 'Vereinigtes KÃ¶nigreich', ar: 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©', zh: 'è‹±å›½' },
  'germany': { es: 'Alemania', en: 'Germany', fr: 'Allemagne', de: 'Deutschland', ar: 'Ø£Ù„Ù…Ø§Ù†ÙŠØ§', zh: 'å¾·å›½' },
  'china': { es: 'China', en: 'China', fr: 'Chine', de: 'China', ar: 'Ø§Ù„ØµÙŠÙ†', zh: 'ä¸­å›½' },
  'japan': { es: 'JapÃ³n', en: 'Japan', fr: 'Japon', de: 'Japan', ar: 'Ø§Ù„ÙŠØ§Ø¨Ø§Ù†', zh: 'æ—¥æœ¬' },
  'russia': { es: 'Rusia', en: 'Russia', fr: 'Russie', de: 'Russland', ar: 'Ø±ÙˆØ³ÙŠØ§', zh: 'ä¿„ç½—æ–¯' },
  'uae': { es: 'Emiratos Ãrabes', en: 'UAE', fr: 'Ã‰mirats arabes', de: 'VAE', ar: 'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª', zh: 'é˜¿è”é…‹' }
};
const cityMap = {
  'madrid': { es: 'Madrid', en: 'Madrid', fr: 'Madrid', de: 'Madrid', ar: 'Ù…Ø¯Ø±ÙŠØ¯', zh: 'é©¬å¾·é‡Œ' },
  'barcelona': { es: 'Barcelona', en: 'Barcelona', fr: 'Barcelone', de: 'Barcelona', ar: 'Ø¨Ø±Ø´Ù„ÙˆÙ†Ø©', zh: 'å·´å¡žç½—é‚£' },
  'paris': { es: 'ParÃ­s', en: 'Paris', fr: 'Paris', de: 'Paris', ar: 'Ø¨Ø§Ø±ÙŠØ³', zh: 'å·´é»Ž' },
  'rome': { es: 'Roma', en: 'Rome', fr: 'Rome', de: 'Rom', ar: 'Ø±ÙˆÙ…Ø§', zh: 'ç½—é©¬' },
  'london': { es: 'Londres', en: 'London', fr: 'Londres', de: 'London', ar: 'Ù„Ù†Ø¯Ù†', zh: 'ä¼¦æ•¦' }
};
function normalize(str) {
  return str.trim().toLowerCase().replace(/[Ã¡Ã Ã¤Ã¢]/g,'a').replace(/[Ã©Ã¨Ã«Ãª]/g,'e').replace(/[Ã­Ã¬Ã¯Ã®]/g,'i').replace(/[Ã³Ã²Ã¶Ã´]/g,'o').replace(/[ÃºÃ¹Ã¼Ã»]/g,'u');
}
function translateCountry(str, lang) {
  let key = normalize(str);
  for (let k in countryMap) {
    if (key === k || key === normalize(countryMap[k].es) || key === normalize(countryMap[k].en) || key === normalize(countryMap[k].fr) || key === normalize(countryMap[k].de) || key === normalize(countryMap[k].ar) || key === normalize(countryMap[k].zh)) {
      return countryMap[k][lang] || str;
    }
  }
  return str;
}
function translateCity(str, lang) {
  let key = normalize(str);
  for (let k in cityMap) {
    if (key === k || key === normalize(cityMap[k].es) || key === normalize(cityMap[k].en) || key === normalize(cityMap[k].fr) || key === normalize(cityMap[k].de) || key === normalize(cityMap[k].ar) || key === normalize(cityMap[k].zh)) {
      return cityMap[k][lang] || str;
    }
  }
  return str;
}
const textos = {
  es: { 
    tabs: ['ðŸ½ï¸ AÃ±adir Visita','ðŸ“Š Resumen','ðŸ“œ Historial','ðŸ•ðŸ£ðŸ” Explorar','ðŸ‘« Amigos'],
    addTitle: 'ðŸ½ï¸ AÃ±adir visita',
    resumenTitle: 'ðŸ“Š Resumen de visitas',
    historialTitle: 'ðŸ“œ Historial de visitas',
    explorarTitle: 'ðŸ•ðŸ£ðŸ” Explorar restaurantes',
    amigosTitle: 'ðŸ‘« Amigos',
    lblRestaurante: 'ðŸ´ Nombre restaurante:',
    lblFecha: 'ðŸ“… Fecha de la visita:',
    lblCiudad: 'ðŸ™ï¸ Ciudad:',
    lblPais: 'ðŸŒ PaÃ­s:',
    lblComensales: 'ðŸ‘¥ NÃºmero de comensales:',
    lblTotal: 'ðŸ’¸ Gasto total:',
    lblAvgPrice: 'ðŸ’° Precio medio por comensal:',
    lblValoracion: 'â­ ValoraciÃ³n:',
    lblReseÃ±a: 'ðŸ“ ReseÃ±a:',
    lblTicket: 'ðŸ§¾ Subir ticket:',
    btnGuardar: 'ðŸ’¾ Guardar visita',
    lblYear: 'AÃ±o:',
    selectCiudad: 'Selecciona ciudad',
    selectPais: 'Selecciona paÃ­s',
    selectMoneda: 'Selecciona moneda',
    selectYear: 'Todos los aÃ±os',
    placeholderRestaurante: 'Introduce el nombre',
    placeholderCiudad: 'Introduce la ciudad',
    placeholderPais: 'Introduce el paÃ­s',
    placeholderReseÃ±a: 'Escribe tu reseÃ±a',
    lblHistRest: 'Restaurante:',
    lblHistCiudad: 'Ciudad:',
    lblHistPais: 'PaÃ­s:',
    lblExpRest: 'Restaurante:',
    lblExpCiudad: 'Ciudad:',
    lblExpPais: 'PaÃ­s:',
    lblExpUsuario: 'Usuario:',
    lblAmigosUsuario: 'Usuario:',
    lblAmigosCiudad: 'Ciudad:',
    lblAmigosPais: 'PaÃ­s:'
  },
  en: { 
    tabs: ['ðŸ½ï¸ Add Visit','ðŸ“Š Summary','ðŸ“œ History','ðŸ•ðŸ£ðŸ” Explore','ðŸ‘« Friends'],
    addTitle: 'ðŸ½ï¸ Add visit',
    resumenTitle: 'ðŸ“Š Visit summary',
    historialTitle: 'ðŸ“œ Visit history',
    explorarTitle: 'ðŸ•ðŸ£ðŸ” Explore restaurants',
    amigosTitle: 'ðŸ‘« Friends',
    lblRestaurante: 'ðŸ´ Restaurant name:',
    lblFecha: 'ðŸ“… Visit date:',
    lblCiudad: 'ðŸ™ï¸ City:',
    lblPais: 'ðŸŒ Country:',
    lblComensales: 'ðŸ‘¥ Number of diners:',
    lblTotal: 'ðŸ’¸ Total spent:',
    lblAvgPrice: 'ðŸ’° Average price per diner:',
    lblValoracion: 'â­ Rating:',
    lblReseÃ±a: 'ðŸ“ Review:',
    lblTicket: 'ðŸ§¾ Upload receipt:',
    btnGuardar: 'ðŸ’¾ Save visit',
    lblYear: 'Year:',
    selectCiudad: 'Select city',
    selectPais: 'Select country',
    selectMoneda: 'Select currency',
    selectYear: 'All years',
    placeholderRestaurante: 'Enter name',
    placeholderCiudad: 'Enter city',
    placeholderPais: 'Enter country',
    placeholderReseÃ±a: 'Write your review',
    lblHistRest: 'Restaurant:',
    lblHistCiudad: 'City:',
    lblHistPais: 'Country:',
    lblExpRest: 'Restaurant:',
    lblExpCiudad: 'City:',
    lblExpPais: 'Country:',
    lblExpUsuario: 'User:',
    lblAmigosUsuario: 'User:',
    lblAmigosCiudad: 'City:',
    lblAmigosPais: 'Country:'
  },
  fr: { 
    tabs: ['ðŸ½ï¸ Ajouter visite','ðŸ“Š RÃ©sumÃ©','ðŸ“œ Historique','ðŸ•ðŸ£ðŸ” Explorer','ðŸ‘« Amis'],
    addTitle: 'ðŸ½ï¸ Ajouter visite',
    resumenTitle: 'ðŸ“Š RÃ©sumÃ© des visites',
    historialTitle: 'ðŸ“œ Historique des visites',
    explorarTitle: 'ðŸ•ðŸ£ðŸ” Explorer les restaurants',
    amigosTitle: 'ðŸ‘« Amis',
    lblRestaurante: 'ðŸ´ Nom du restaurant:',
    lblFecha: 'ðŸ“… Date de la visite:',
    lblCiudad: 'ðŸ™ï¸ Ville:',
    lblPais: 'ðŸŒ Pays:',
    lblComensales: 'ðŸ‘¥ Nombre de convives:',
    lblTotal: 'ðŸ’¸ DÃ©pense totale:',
    lblAvgPrice: 'ðŸ’° Prix moyen par convive:',
    lblValoracion: 'â­ Note:',
    lblReseÃ±a: 'ðŸ“ Avis:',
    lblTicket: 'ðŸ§¾ TÃ©lÃ©charger le ticket:',
    btnGuardar: 'ðŸ’¾ Enregistrer la visite',
    lblYear: 'AnnÃ©e:',
    selectCiudad: 'SÃ©lectionner ville',
    selectPais: 'SÃ©lectionner pays',
    selectMoneda: 'SÃ©lectionner monnaie',
    selectYear: 'Toutes les annÃ©es',
    placeholderRestaurante: 'Entrez le nom',
    placeholderCiudad: 'Entrez la ville',
    placeholderPais: 'Entrez le pays',
    placeholderReseÃ±a: 'Ã‰crivez votre avis',
    lblHistRest: 'Restaurant:',
    lblHistCiudad: 'Ville:',
    lblHistPais: 'Pays:',
    lblExpRest: 'Restaurant:',
    lblExpCiudad: 'Ville:',
    lblExpPais: 'Pays:',
    lblExpUsuario: 'Utilisateur:',
    lblAmigosUsuario: 'Utilisateur:',
    lblAmigosCiudad: 'Ville:',
    lblAmigosPais: 'Pays:'
  },
  de: { 
    tabs: ['ðŸ½ï¸ Besuch hinzufÃ¼gen','ðŸ“Š Ãœbersicht','ðŸ“œ Historie','ðŸ•ðŸ£ðŸ” Entdecken','ðŸ‘« Freunde'],
    addTitle: 'ðŸ½ï¸ Besuch hinzufÃ¼gen',
    resumenTitle: 'ðŸ“Š BesuchsÃ¼bersicht',
    historialTitle: 'ðŸ“œ Besuchshistorie',
    explorarTitle: 'ðŸ•ðŸ£ðŸ” Restaurants entdecken',
    amigosTitle: 'ðŸ‘« Freunde',
    lblRestaurante: 'ðŸ´ Restaurantname:',
    lblFecha: 'ðŸ“… Besuchsdatum:',
    lblCiudad: 'ðŸ™ï¸ Stadt:',
    lblPais: 'ðŸŒ Land:',
    lblComensales: 'ðŸ‘¥ Anzahl GÃ¤ste:',
    lblTotal: 'ðŸ’¸ Gesamtausgabe:',
    lblAvgPrice: 'ðŸ’° Durchschnittspreis pro Gast:',
    lblValoracion: 'â­ Bewertung:',
    lblReseÃ±a: 'ðŸ“ Rezension:',
    lblTicket: 'ðŸ§¾ Beleg hochladen:',
    btnGuardar: 'ðŸ’¾ Besuch speichern',
    lblYear: 'Jahr:',
    selectCiudad: 'Stadt wÃ¤hlen',
    selectPais: 'Land wÃ¤hlen',
    selectMoneda: 'WÃ¤hrung wÃ¤hlen',
    selectYear: 'Alle Jahre',
    placeholderRestaurante: 'Name eingeben',
    placeholderCiudad: 'Stadt eingeben',
    placeholderPais: 'Land eingeben',
    placeholderReseÃ±a: 'Rezension schreiben',
    lblHistRest: 'Restaurant:',
    lblHistCiudad: 'Stadt:',
    lblHistPais: 'Land:',
    lblExpRest: 'Restaurant:',
    lblExpCiudad: 'Stadt:',
    lblExpPais: 'Land:',
    lblExpUsuario: 'Benutzer:',
    lblAmigosUsuario: 'Benutzer:',
    lblAmigosCiudad: 'Stadt:',
    lblAmigosPais: 'Land:'
  },
  ar: { 
    tabs: ['ðŸ½ï¸ Ø¥Ø¶Ø§ÙØ© Ø²ÙŠØ§Ø±Ø©','ðŸ“Š Ù…Ù„Ø®Øµ','ðŸ“œ ØªØ§Ø±ÙŠØ®','ðŸ•ðŸ£ðŸ” Ø§Ø³ØªÙƒØ´Ø§Ù','ðŸ‘« Ø£ØµØ¯Ù‚Ø§Ø¡'],
    addTitle: 'ðŸ½ï¸ Ø¥Ø¶Ø§ÙØ© Ø²ÙŠØ§Ø±Ø©',
    resumenTitle: 'ðŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª',
    historialTitle: 'ðŸ“œ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª',
    explorarTitle: 'ðŸ•ðŸ£ðŸ” Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ù…Ø·Ø§Ø¹Ù…',
    amigosTitle: 'ðŸ‘« Ø£ØµØ¯Ù‚Ø§Ø¡',
    lblRestaurante: 'ðŸ´ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…:',
    lblFecha: 'ðŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø²ÙŠØ§Ø±Ø©:',
    lblCiudad: 'ðŸ™ï¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:',
    lblPais: 'ðŸŒ Ø§Ù„Ø¯ÙˆÙ„Ø©:',
    lblComensales: 'ðŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ:',
    lblTotal: 'ðŸ’¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ù†ÙØ§Ù‚:',
    lblAvgPrice: 'ðŸ’° Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø± Ù„ÙƒÙ„ Ø´Ø®Øµ:',
    lblValoracion: 'â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:',
    lblReseÃ±a: 'ðŸ“ Ù…Ø±Ø§Ø¬Ø¹Ø©:',
    lblTicket: 'ðŸ§¾ Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„:',
    btnGuardar: 'ðŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø²ÙŠØ§Ø±Ø©',
    lblYear: 'Ø§Ù„Ø³Ù†Ø©:',
    selectCiudad: 'Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
    selectPais: 'Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø©',
    selectMoneda: 'Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø©',
    selectYear: 'ÙƒÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª',
    placeholderRestaurante: 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…',
    placeholderCiudad: 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
    placeholderPais: 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¯ÙˆÙ„Ø©',
    placeholderReseÃ±a: 'Ø§ÙƒØªØ¨ Ù…Ø±Ø§Ø¬Ø¹ØªÙƒ',
    lblHistRest: 'Ù…Ø·Ø¹Ù…:',
    lblHistCiudad: 'Ù…Ø¯ÙŠÙ†Ø©:',
    lblHistPais: 'Ø¯ÙˆÙ„Ø©:',
    lblExpRest: 'Ù…Ø·Ø¹Ù…:',
    lblExpCiudad: 'Ù…Ø¯ÙŠÙ†Ø©:',
    lblExpPais: 'Ø¯ÙˆÙ„Ø©:',
    lblExpUsuario: 'Ù…Ø³ØªØ®Ø¯Ù…:',
    lblAmigosUsuario: 'Ù…Ø³ØªØ®Ø¯Ù…:',
    lblAmigosCiudad: 'Ù…Ø¯ÙŠÙ†Ø©:',
    lblAmigosPais: 'Ø¯ÙˆÙ„Ø©:'
  },
  zh: { 
    tabs: ['ðŸ½ï¸ æ·»åŠ è®¿é—®','ðŸ“Š æ‘˜è¦','ðŸ“œ åŽ†å²','ðŸ•ðŸ£ðŸ” æŽ¢ç´¢','ðŸ‘« æœ‹å‹'],
    addTitle: 'ðŸ½ï¸ æ·»åŠ è®¿é—®',
    resumenTitle: 'ðŸ“Š è®¿é—®æ‘˜è¦',
    historialTitle: 'ðŸ“œ è®¿é—®åŽ†å²',
    explorarTitle: 'ðŸ•ðŸ£ðŸ” æŽ¢ç´¢é¤åŽ…',
    amigosTitle: 'ðŸ‘« æœ‹å‹',
    lblRestaurante: 'ðŸ´ é¤åŽ…åç§°:',
    lblFecha: 'ðŸ“… è®¿é—®æ—¥æœŸ:',
    lblCiudad: 'ðŸ™ï¸ åŸŽå¸‚:',
    lblPais: 'ðŸŒ å›½å®¶:',
    lblComensales: 'ðŸ‘¥ äººæ•°:',
    lblTotal: 'ðŸ’¸ æ€»èŠ±è´¹:',
    lblAvgPrice: 'ðŸ’° äººå‡ä»·æ ¼:',
    lblValoracion: 'â­ è¯„åˆ†:',
    lblReseÃ±a: 'ðŸ“ è¯„è®º:',
    lblTicket: 'ðŸ§¾ ä¸Šä¼ ç¥¨æ®:',
    btnGuardar: 'ðŸ’¾ ä¿å­˜è®¿é—®',
    lblYear: 'å¹´ä»½:',
    selectCiudad: 'é€‰æ‹©åŸŽå¸‚',
    selectPais: 'é€‰æ‹©å›½å®¶',
    selectMoneda: 'é€‰æ‹©è´§å¸',
    selectYear: 'æ‰€æœ‰å¹´ä»½',
    placeholderRestaurante: 'è¾“å…¥åç§°',
    placeholderCiudad: 'è¾“å…¥åŸŽå¸‚',
    placeholderPais: 'è¾“å…¥å›½å®¶',
    placeholderReseÃ±a: 'å†™ä¸‹ä½ çš„è¯„è®º',
    lblHistRest: 'é¤åŽ…:',
    lblHistCiudad: 'åŸŽå¸‚:',
    lblHistPais: 'å›½å®¶:',
    lblExpRest: 'é¤åŽ…:',
    lblExpCiudad: 'åŸŽå¸‚:',
    lblExpPais: 'å›½å®¶:',
    lblExpUsuario: 'ç”¨æˆ·:',
    lblAmigosUsuario: 'ç”¨æˆ·:',
    lblAmigosCiudad: 'åŸŽå¸‚:',
    lblAmigosPais: 'å›½å®¶:'
  }
};
// Idiomas y banderas
const idiomas = [
  { code: 'es', logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f1ea-1f1f8.svg', label: 'EspaÃ±ol' },
  { code: 'en', logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f1ec-1f1e7.svg', label: 'English' },
  { code: 'fr', logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f1eb-1f1f7.svg', label: 'FranÃ§ais' },
  { code: 'de', logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f1e9-1f1ea.svg', label: 'Deutsch' },
  { code: 'ar', logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f1e6-1f1ea.svg', label: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' },
  { code: 'zh', logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f1e8-1f1f3.svg', label: 'ä¸­æ–‡' }
];
// Traducciones principales


// Monedas ampliadas
const monedas = [
  { code: 'â‚¬', label: { es: 'Euro', en: 'Euro', fr: 'Euro', de: 'Euro', ar: 'ÙŠÙˆØ±Ùˆ', zh: 'æ¬§å…ƒ' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/20ac.svg' },
  { code: '$', label: { es: 'DÃ³lar USA', en: 'US Dollar', fr: 'Dollar US', de: 'US-Dollar', ar: 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ', zh: 'ç¾Žå…ƒ' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b5.svg' },
  { code: 'Â£', label: { es: 'Libra esterlina', en: 'Pound Sterling', fr: 'Livre sterling', de: 'Pfund Sterling', ar: 'Ø¬Ù†ÙŠÙ‡ Ø¥Ø³ØªØ±Ù„ÙŠÙ†ÙŠ', zh: 'è‹±é•‘' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b7.svg' },
  { code: 'AED', label: { es: 'Dirham', en: 'Dirham', fr: 'Dirham', de: 'Dirham', ar: 'Ø¯Ø±Ù‡Ù…', zh: 'è¿ªæ‹‰å§†' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b6.svg' },
  { code: 'Â¥', label: { es: 'Yen japonÃ©s', en: 'Japanese Yen', fr: 'Yen japonais', de: 'Japanischer Yen', ar: 'ÙŠÙ† ÙŠØ§Ø¨Ø§Ù†ÙŠ', zh: 'æ—¥å…ƒ' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b4.svg' },
  { code: 'å…ƒ', label: { es: 'Yuan chino', en: 'Chinese Yuan', fr: 'Yuan chinois', de: 'Chinesischer Yuan', ar: 'ÙŠÙˆØ§Ù† ØµÙŠÙ†ÙŠ', zh: 'äººæ°‘å¸' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b4.svg' },
  { code: 'A$', label: { es: 'DÃ³lar australiano', en: 'Australian Dollar', fr: 'Dollar australien', de: 'Australischer Dollar', ar: 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ø³ØªØ±Ø§Ù„ÙŠ', zh: 'æ¾³å…ƒ' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b5.svg' },
  { code: 'â‚½', label: { es: 'Rublo ruso', en: 'Russian Ruble', fr: 'Rouble russe', de: 'Russischer Rubel', ar: 'Ø±ÙˆØ¨Ù„ Ø±ÙˆØ³ÙŠ', zh: 'ä¿„ç½—æ–¯å¢å¸ƒ' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b2.svg' },
  { code: 'CHF', label: { es: 'Franco suizo', en: 'Swiss Franc', fr: 'Franc suisse', de: 'Schweizer Franken', ar: 'ÙØ±Ù†Ùƒ Ø³ÙˆÙŠØ³Ø±ÙŠ', zh: 'ç‘žå£«æ³•éƒŽ' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b2.svg' },
  { code: 'DKK', label: { es: 'Corona danesa', en: 'Danish Krone', fr: 'Couronne danoise', de: 'DÃ¤nische Krone', ar: 'ÙƒØ±ÙˆÙ†Ø© Ø¯Ù†Ù…Ø§Ø±ÙƒÙŠØ©', zh: 'ä¸¹éº¦å…‹æœ—' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b2.svg' },
  { code: 'SGD', label: { es: 'DÃ³lar de Singapur', en: 'Singapore Dollar', fr: 'Dollar de Singapour', de: 'Singapur-Dollar', ar: 'Ø¯ÙˆÙ„Ø§Ø± Ø³Ù†ØºØ§ÙÙˆØ±ÙŠ', zh: 'æ–°åŠ å¡å…ƒ' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b5.svg' },
  { code: 'CAD', label: { es: 'DÃ³lar canadiense', en: 'Canadian Dollar', fr: 'Dollar canadien', de: 'Kanadischer Dollar', ar: 'Ø¯ÙˆÙ„Ø§Ø± ÙƒÙ†Ø¯ÙŠ', zh: 'åŠ æ‹¿å¤§å…ƒ' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b5.svg' },
  { code: 'MXN', label: { es: 'Peso mexicano', en: 'Mexican Peso', fr: 'Peso mexicain', de: 'Mexikanischer Peso', ar: 'Ø¨ÙŠØ²Ùˆ Ù…ÙƒØ³ÙŠÙƒÙŠ', zh: 'å¢¨è¥¿å“¥æ¯”ç´¢' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b2.svg' },
  { code: 'BRL', label: { es: 'Real brasileÃ±o', en: 'Brazilian Real', fr: 'Real brÃ©silien', de: 'Brasilianischer Real', ar: 'Ø±ÙŠØ§Ù„ Ø¨Ø±Ø§Ø²ÙŠÙ„ÙŠ', zh: 'å·´è¥¿é›·äºšå°”' }, logo: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4b2.svg' }
];

// Datos de ejemplo
let ciudades = ['Madrid','Barcelona','ParÃ­s','Roma','London'];
let paises = ['EspaÃ±a','Francia','Italia','England','Great Britain'];
let usuarios = ['Paco','Ana','Luis'];
let restaurantes = ['La Tagliatella','Sushi House','Casa Paco'];
let visitas = [
  { usuario: 'Paco', restaurante: 'La Tagliatella', ciudad: 'Madrid', pais: 'EspaÃ±a', fecha: '2024-05-10', comensales: 4, total: 120, moneda: 'â‚¬', valoracion: 4, reseÃ±a: 'Muy bueno', lat: 40.4168, lng: -3.7038, ticket: '' },
  { usuario: 'Ana', restaurante: 'La Tagliatella', ciudad: 'Madrid', pais: 'EspaÃ±a', fecha: '2025-03-12', comensales: 2, total: 60, moneda: 'â‚¬', valoracion: 5, reseÃ±a: 'Excelente', lat: 40.4168, lng: -3.7038, ticket: '' },
  { usuario: 'Luis', restaurante: 'Sushi House', ciudad: 'Barcelona', pais: 'EspaÃ±a', fecha: '2025-06-18', comensales: 2, total: 80, moneda: 'â‚¬', valoracion: 5, reseÃ±a: 'FantÃ¡stico', lat: 41.3851, lng: 2.1734, ticket: '' }
];

// InicializaciÃ³n idioma y tema
function initLangTheme() {
  let langSel = document.getElementById('lang');
  langSel.innerHTML = idiomas.map(l => `<option value="${l.code}">${l.label}</option>`).join('');
  langSel.value = 'es';
  document.getElementById('theme').value = 'dark';
  setTheme();
}
function capitalizeInput(input) {
  let val = input.value;
  val = val.replace(/\b\w+\b/g, function(word) {
    // Pasa toda la palabra a minÃºscula
    word = word.toLowerCase();
    // Capitaliza la primera letra
    word = word.charAt(0).toUpperCase() + word.slice(1);
    // Fuerza la vocal tras "Ã±" a minÃºscula, aunque estÃ© en segunda posiciÃ³n
    return word.replace(/Ã±([A-ZÃÃ‰ÃÃ“Ãš])/g, function(m, v) {
      return 'Ã±' + v.toLowerCase();
    }).replace(/Ã±([a-zÃ¡Ã©Ã­Ã³Ãº])/g, function(m, v) {
      return 'Ã±' + v.toLowerCase();
    });
  });
  input.value = val;
}

// Actualiza textos y datalist
function setLang() {
  let lang = document.getElementById('lang').value;
  let t = textos[lang];
  document.getElementById('langLogo').src = idiomas.find(l => l.code === lang).logo;
  document.getElementById('tabBtn0').innerText = t.tabs[0];
  document.getElementById('tabBtn1').innerText = t.tabs[1];
  document.getElementById('tabBtn2').innerText = t.tabs[2];
  document.getElementById('tabBtn3').innerText = t.tabs[3];
  document.getElementById('tabBtn4').innerText = t.tabs[4];
  document.getElementById('addTitle').innerText = t.addTitle;
  document.getElementById('resumenTitle').innerText = t.resumenTitle;
  document.getElementById('historialTitle').innerText = t.historialTitle;
  document.getElementById('explorarTitle').innerText = t.explorarTitle;
  document.getElementById('amigosTitle').innerText = t.amigosTitle;
  document.getElementById('lblRestaurante').innerText = t.lblRestaurante;
  document.getElementById('lblFecha').innerText = t.lblFecha;
  document.getElementById('lblCiudad').innerText = t.lblCiudad;
  document.getElementById('lblPais').innerText = t.lblPais;
  document.getElementById('lblComensales').innerText = t.lblComensales;
  document.getElementById('lblTotal').innerText = t.lblTotal;
  document.getElementById('lblAvgPrice').innerText = t.lblAvgPrice;
  document.getElementById('lblValoracion').innerText = t.lblValoracion;
  document.getElementById('lblReseÃ±a').innerText = t.lblReseÃ±a;
  document.getElementById('lblTicket').innerText = t.lblTicket;
  document.getElementById('btnGuardar').innerText = t.btnGuardar;
  document.getElementById('lblYear').innerText = t.lblYear;
  document.getElementById('restaurante').placeholder = t.placeholderRestaurante;
  document.getElementById('ciudadInput').placeholder = t.placeholderCiudad;
  document.getElementById('paisInput').placeholder = t.placeholderPais;
  document.getElementById('reseÃ±a').placeholder = t.placeholderReseÃ±a;
  document.getElementById('lblHistRest').innerText = t.lblHistRest;
  document.getElementById('lblHistCiudad').innerText = t.lblHistCiudad;
  document.getElementById('lblHistPais').innerText = t.lblHistPais;
  document.getElementById('lblExpRest').innerText = t.lblExpRest;
  document.getElementById('lblExpCiudad').innerText = t.lblExpCiudad;
  document.getElementById('lblExpPais').innerText = t.lblExpPais;
  document.getElementById('lblExpUsuario').innerText = t.lblExpUsuario;
  document.getElementById('lblAmigosUsuario').innerText = t.lblAmigosUsuario;
  document.getElementById('lblAmigosCiudad').innerText = t.lblAmigosCiudad;
  document.getElementById('lblAmigosPais').innerText = t.lblAmigosPais;
  // Datalist ciudad/pais/restaurante
  document.getElementById('ciudadList').innerHTML = [...new Set(ciudades.map(c => translateCity(c, lang)))].map(c => `<option value="${c}">`).join('');
  document.getElementById('paisList').innerHTML = [...new Set(paises.map(p => translateCountry(p, lang)))].map(p => `<option value="${p}">`).join('');
  document.getElementById('restauranteList').innerHTML = [...new Set(restaurantes)].map(r => `<option value="${r}">`).join('');
  // Monedas con logo
  document.getElementById('moneda').innerHTML = monedas.map(m =>
    `<option value="${m.code}">${m.label[lang]}</option>`
  ).join('');
  document.getElementById('year').innerHTML = `<option value="todos">${t.selectYear}</option>` + [...new Set(visitas.map(v => new Date(v.fecha).getFullYear()))].map(a => `<option value="${a}">${a}</option>`).join('');
  document.getElementById('histRest').innerHTML = `<option value="todos">${t.tabs[0]}</option>` + restaurantes.map(r => `<option>${r}</option>`).join('');
  document.getElementById('histCiudad').innerHTML = `<option value="todos">${t.selectCiudad}</option>` + ciudades.map(c => `<option>${translateCity(c, lang)}</option>`).join('');
  document.getElementById('histPais').innerHTML = `<option value="todos">${t.selectPais}</option>` + paises.map(p => `<option>${translateCountry(p, lang)}</option>`).join('');
  document.getElementById('explorarRestaurante').innerHTML = `<option value="todos">${t.tabs[0]}</option>` + restaurantes.map(r => `<option>${r}</option>`).join('');
  document.getElementById('explorarCiudad').innerHTML = `<option value="todos">${t.selectCiudad}</option>` + ciudades.map(c => `<option>${translateCity(c, lang)}</option>`).join('');
  document.getElementById('explorarPais').innerHTML = `<option value="todos">${t.selectPais}</option>` + paises.map(p => `<option>${translateCountry(p, lang)}</option>`).join('');
  document.getElementById('explorarUsuario').innerHTML = `<option value="todos">${t.tabs[4]}</option>` + usuarios.map(u => `<option>${u}</option>`).join('');
  document.getElementById('amigosUsuario').innerHTML = `<option value="todos">${t.tabs[4]}</option>` + usuarios.map(u => `<option>${u}</option>`).join('');
  document.getElementById('amigosCiudad').innerHTML = `<option value="todos">${t.selectCiudad}</option>` + ciudades.map(c => `<option>${translateCity(c, lang)}</option>`).join('');
  document.getElementById('amigosPais').innerHTML = `<option value="todos">${t.selectPais}</option>` + paises.map(p => `<option>${translateCountry(p, lang)}</option>`).join('');
  document.getElementById('lblResumenRest').innerText = t.lblRestaurante;
  document.getElementById('lblResumenPais').innerText = t.lblPais;
  document.getElementById('lblResumenCiudad').innerText = t.lblCiudad;
  document.getElementById('resumenRest').innerHTML = `<option value="todos">${t.tabs[0]}</option>` + restaurantes.map(r => `<option>${r}</option>`).join('');
  document.getElementById('resumenPais').innerHTML = `<option value="todos">${t.selectPais}</option>` + paises.map(p => `<option>${translateCountry(p, lang)}</option>`).join('');
  document.getElementById('resumenCiudad').innerHTML = `<option value="todos">${t.selectCiudad}</option>` + ciudades.map(c => `<option>${translateCity(c, lang)}</option>`).join('');
  renderResumen();
  renderHistorial();
  renderExplorar();
  renderAmigosResumen();
}

// Modo claro/oscuro clÃ¡sico
document.getElementById('theme').onchange = setTheme;
function setTheme() {
  let theme = document.getElementById('theme').value;
  let themeLogo = document.getElementById('themeLogo');
  if (theme === 'light') {
    document.body.classList.add('light-mode');
    document.getElementById('mainContainer').classList.add('light-mode');
    themeLogo.src = "https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f31e.svg";
  } else {
    document.body.classList.remove('light-mode');
    document.getElementById('mainContainer').classList.remove('light-mode');
    themeLogo.src = "https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f319.svg";
  }
}

// Tabs
function showTab(idx) {
  for (let i = 0; i < 5; i++) {
    document.getElementById('tab'+i).classList.add('hidden');
    document.getElementById('tabBtn'+i).classList.remove('active');
  }
  document.getElementById('tab'+idx).classList.remove('hidden');
  document.getElementById('tabBtn'+idx).classList.add('active');
  if (idx === 1) renderResumen();
  if (idx === 2) renderHistorial();
  if (idx === 3) renderExplorar();
  if (idx === 4) renderAmigosResumen();
}
document.getElementById('tabBtn0').onclick = () => showTab(0);
document.getElementById('tabBtn1').onclick = () => showTab(1);
document.getElementById('tabBtn2').onclick = () => showTab(2);
document.getElementById('tabBtn3').onclick = () => showTab(3);
document.getElementById('tabBtn4').onclick = () => showTab(4);

// AÃ±adir Visita: CapitalizaciÃ³n y cÃ¡lculo precio medio
document.getElementById('restaurante').oninput = function() { capitalizeInput(this); };
document.getElementById('ciudadInput').oninput = function() { capitalizeInput(this); };
document.getElementById('paisInput').oninput = function() { capitalizeInput(this); };
document.getElementById('total').oninput = calcAvgPrice;
document.getElementById('comensales').oninput = calcAvgPrice;

function calcAvgPrice() {
  let total = parseFloat(document.getElementById('total').value) || 0;
  let comensales = parseInt(document.getElementById('comensales').value) || 1;
  document.getElementById('avgPrice').value = comensales > 0 ? (total / comensales).toFixed(2) : '';
}

// ValoraciÃ³n estrellas
Array.from(document.querySelectorAll('#stars .stars')).forEach(star => {
  star.onclick = function() {
    let n = parseInt(this.getAttribute('data-star'));
    document.getElementById('valoracion').value = n;
    Array.from(document.querySelectorAll('#stars .stars')).forEach((s, i) => {
      s.style.color = i < n ? '#ffd700' : '#444';
    });
  };
});

// Ticket preview
document.getElementById('ticket').onchange = function(e) {
  let file = e.target.files[0];
  if (file) {
    let reader = new FileReader();
    reader.onload = function(ev) {
      let img = document.getElementById('ticketPreview');
      img.src = ev.target.result;
      img.style.display = 'block';
    };
    reader.readAsDataURL(file);
  }
};

// Guardar visita y actualizar datalist
document.getElementById('visitForm').onsubmit = function(e) {
  e.preventDefault();
  let lang = document.getElementById('lang').value;
  let restaurante = document.getElementById('restaurante').value.trim();
  let ciudad = document.getElementById('ciudadInput').value.trim();
  let pais = document.getElementById('paisInput').value.trim();
  let comensales = parseInt(document.getElementById('comensales').value);
  let total = parseFloat(document.getElementById('total').value) || 0;
  let moneda = document.getElementById('moneda').value;
  let avgPrice = parseFloat(document.getElementById('avgPrice').value) || 0;
  let valoracion = parseInt(document.getElementById('valoracion').value) || 0;
  let reseÃ±a = document.getElementById('reseÃ±a').value.trim();
  let ticket = document.getElementById('ticketPreview').src || '';
  let fecha = document.getElementById('fecha').value || new Date().toISOString().slice(0,10);
  let usuario = usuarios[0];
  let lat = null, lng = null;
  if (!restaurante || !ciudad || !pais || !total || !comensales) {
    document.getElementById('visitMsg').innerHTML = `<span style="color:#ff4d4d;">${textos[lang].btnGuardar} - ${textos[lang].lblRestaurante} ${textos[lang].lblCiudad} ${textos[lang].lblPais} ${textos[lang].lblTotal} ${textos[lang].lblComensales}</span>`;
    return;
  }
  // Normaliza y traduce paÃ­s y ciudad
  let paisTrad = translateCountry(pais, lang);
  let ciudadTrad = translateCity(ciudad, lang);
  visitas.push({ usuario, restaurante, ciudad: ciudadTrad, pais: paisTrad, fecha, comensales, total, moneda, valoracion, reseÃ±a, lat, lng, ticket });
  // AÃ±ade ciudad/pais/restaurante si no existen
  if (!ciudades.map(c => translateCity(c, lang)).includes(ciudadTrad)) ciudades.push(ciudadTrad);
  if (!paises.map(p => translateCountry(p, lang)).includes(paisTrad)) paises.push(paisTrad);
  if (!restaurantes.includes(restaurante)) restaurantes.push(restaurante);
  setLang();
  document.getElementById('visitMsg').innerHTML = `<span style="color:#00eaff;">${textos[lang].btnGuardar} OK!</span>`;
  this.reset();
  document.getElementById('ticketPreview').style.display = 'none';
  Array.from(document.querySelectorAll('#stars .stars')).forEach(s => s.style.color = '#444');
  document.getElementById('valoracion').value = 0;
  calcAvgPrice();
};

// RESUMEN
function renderResumen() {
  let lang = document.getElementById('lang').value;
  let aÃ±oSeleccionado = document.getElementById('year').value;
  let restSel = document.getElementById('resumenRest').value;
  let ciudadSel = document.getElementById('resumenCiudad').value;
  let paisSel = document.getElementById('resumenPais').value;
  let filtradas = visitas.filter(v => {
    let aÃ±oOk = aÃ±oSeleccionado === 'todos' || new Date(v.fecha).getFullYear() == aÃ±oSeleccionado;
    let rOk = restSel === 'todos' || v.restaurante === restSel;
    let cOk = ciudadSel === 'todos' || normalize(v.ciudad) === normalize(ciudadSel);
    let pOk = paisSel === 'todos' || normalize(v.pais) === normalize(paisSel);
    return aÃ±oOk && rOk && cOk && pOk;
  });

  let totalesDivisa = {};
  filtradas.forEach(v => {
    if (!totalesDivisa[v.moneda]) totalesDivisa[v.moneda] = 0;
    totalesDivisa[v.moneda] += Number(v.total);
  });

  let totalHtml = Object.entries(totalesDivisa).map(([moneda, total]) =>
    `<div>${textos[lang].lblTotal} <span style="color:#00eaff;">${total} ${moneda}</span></div>`
  ).join('');
  document.getElementById('totalGastado').innerHTML = totalHtml;

  let grupos = {};
  filtradas.forEach(v => {
    let key = v.restaurante + '|' + normalize(v.ciudad) + '|' + normalize(v.pais);
    if (!grupos[key]) grupos[key] = { restaurante: v.restaurante, ciudad: v.ciudad, pais: v.pais, visitas: 0, totalGastado: 0, valoraciones: [], reseÃ±as: [], moneda: v.moneda, comensales: 0, preciosPorComensal: [], lat: v.lat, lng: v.lng };
    grupos[key].visitas += 1;
    grupos[key].totalGastado += Number(v.total);
    grupos[key].valoraciones.push(Number(v.valoracion));
    grupos[key].reseÃ±as.push({ usuario: v.usuario, reseÃ±a: v.reseÃ±a });
    grupos[key].comensales += Number(v.comensales);
    grupos[key].preciosPorComensal.push(Number(v.total) / Number(v.comensales));
  });

  let html = '';
  Object.values(grupos).forEach(grupo => {
    let valoracionMedia = grupo.valoraciones.length ? (grupo.valoraciones.reduce((a,b)=>a+b,0)/grupo.valoraciones.length).toFixed(1) : '0';
    let precioMedio = grupo.preciosPorComensal.length
        ? (grupo.preciosPorComensal.reduce((a,b)=>a+b,0)/grupo.preciosPorComensal.length).toFixed(2)
        : '0.00';
    let mapsLink = `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(grupo.restaurante + ' ' + grupo.ciudad + ' ' + grupo.pais)}" target="_blank" style="color:#00eaff;">Google Maps</a>`;
    html += `<div class="card">
      <div class="restaurante-nombre">${grupo.restaurante}</div>
      <div>${textos[lang].lblCiudad.split(':')[0]}: ${grupo.ciudad}</div>
      <div>${textos[lang].lblPais.split(':')[0]}: ${grupo.pais}</div>
      <div><b>NÃºmero de visitas:</b> ${grupo.visitas}</div>
      <div>${textos[lang].lblTotal} <b>${grupo.totalGastado} ${grupo.moneda}</b></div>
      <div>${textos[lang].lblAvgPrice.split(':')[0]}: <b>${precioMedio} ${grupo.moneda}</b></div>
      <div>${textos[lang].lblValoracion.split(':')[0]}: <span class="stars">${'â˜…'.repeat(Math.round(valoracionMedia))}${'â˜†'.repeat(5-Math.round(valoracionMedia))}</span> (${valoracionMedia})</div>
      <div><b>${textos[lang].lblReseÃ±a.split(':')[0]}:</b><ul class="review-list">${grupo.reseÃ±as.map(r=>`<li><span class="usuario-nombre">${r.usuario}</span>: ${r.reseÃ±a}</li>`).join('')}</ul></div>
      ${mapsLink}
    </div>`;
  });
  document.getElementById('resumenCards').innerHTML = html;
}
document.getElementById('year').onchange = renderResumen;

// HISTORIAL
function renderHistorial() {
  let lang = document.getElementById('lang').value;
  let restSel = document.getElementById('histRest').value;
  let ciudadSel = document.getElementById('histCiudad').value;
  let paisSel = document.getElementById('histPais').value;
  let html = '';
  let filtradas = visitas.filter(v => {
    let rOk = restSel === 'todos' || v.restaurante === restSel;
    let cOk = ciudadSel === 'todos' || normalize(v.ciudad) === normalize(ciudadSel);
    let pOk = paisSel === 'todos' || normalize(v.pais) === normalize(paisSel);
    return rOk && cOk && pOk;
  });
  filtradas.slice().sort((a,b)=>new Date(b.fecha)-new Date(a.fecha)).forEach((v, idx) => {
  let precioMedio = v.comensales > 0 ? (v.total / v.comensales).toFixed(2) : '0.00';
  html += `<div class="card">
    <div class="restaurante-nombre">${v.restaurante}</div>
    <div>(${v.ciudad}, ${v.pais})</div>
    <div>${textos[lang].lblFecha.split(':')[0]}: ${v.fecha}</div>
    <div>${textos[lang].lblComensales.split(':')[0]}: ${v.comensales}</div>
    <div>${textos[lang].lblTotal} ${v.total} ${v.moneda}</div>
    <div>${textos[lang].lblAvgPrice.split(':')[0]}: <b>${precioMedio} ${v.moneda}</b></div>
    <div>${textos[lang].lblValoracion.split(':')[0]}: <span class="stars">${'â˜…'.repeat(v.valoracion)}${'â˜†'.repeat(5-v.valoracion)}</span></div>
    <div>${textos[lang].lblReseÃ±a.split(':')[0]}: ${v.reseÃ±a}</div>
    ${v.ticket ? `<button class="btn" onclick="mostrarTicket('${v.ticket}')">Ver ticket</button>` : ''}
    <button class="btn delete-btn" title="Eliminar" onclick="eliminarVisita(${idx})"><img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f5d1.svg" alt="Eliminar"></button>
  </div>`;
});
  document.getElementById('historialCards').innerHTML = html;
}
window.eliminarVisita = function(idx) {
  let lang = document.getElementById('lang').value;
  let restSel = document.getElementById('histRest').value;
  let ciudadSel = document.getElementById('histCiudad').value;
  let paisSel = document.getElementById('histPais').value;
  // Filtra igual que en renderHistorial
  let filtradas = visitas.filter(v => {
    let rOk = restSel === 'todos' || v.restaurante === restSel;
    let cOk = ciudadSel === 'todos' || normalize(v.ciudad) === normalize(ciudadSel);
    let pOk = paisSel === 'todos' || normalize(v.pais) === normalize(paisSel);
    return rOk && cOk && pOk;
  });
  let visita = filtradas.slice().sort((a,b)=>new Date(b.fecha)-new Date(a.fecha))[idx];
  let iReal = visitas.findIndex(v =>
    v.restaurante === visita.restaurante &&
    v.ciudad === visita.ciudad &&
    v.pais === visita.pais &&
    v.fecha === visita.fecha &&
    v.usuario === visita.usuario
  );
  if (iReal > -1 && confirm('Â¿Seguro que quieres eliminar esta visita?')) {
    visitas.splice(iReal, 1);
    renderHistorial();
    renderResumen();
    renderExplorar();
    renderAmigosResumen();
  }
};

function getTopActiveUsers(visitas, topN = 10) {
  let counts = {};
  visitas.forEach(v => {
    counts[v.usuario] = (counts[v.usuario] || 0) + 1;
  });
  return Object.entries(counts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, topN)
    .map(([usuario]) => usuario);
}

function getTopRatedRestaurants(visitas, usuarios, topN = 10) {
  let agrupados = {};
  visitas.forEach(v => {
    if (!usuarios.includes(v.usuario)) return;
    const key = v.restaurante + '|' + normalize(v.ciudad) + '|' + normalize(v.pais);
    if (!agrupados[key]) agrupados[key] = { nombre: v.restaurante, ciudad: v.ciudad, pais: v.pais, moneda: v.moneda, valoraciones: [], precios: [], reseÃ±as: [], visitas: 0 };
    agrupados[key].valoraciones.push(v.valoracion);
    agrupados[key].precios.push(v.total / v.comensales);
    agrupados[key].reseÃ±as.push({ usuario: v.usuario, reseÃ±a: v.reseÃ±a });
    agrupados[key].visitas += 1;
  });
  let arr = Object.values(agrupados).map(grupo => {
    grupo.valoracionMedia = grupo.valoraciones.length ? (grupo.valoraciones.reduce((a,b)=>a+b,0)/grupo.valoraciones.length) : 0;
    return grupo;
  });
  return arr.sort((a, b) => b.valoracionMedia - a.valoracionMedia).slice(0, topN);
}

function renderExplorar() {
  let lang = document.getElementById('lang').value;
  let restauranteSel = document.getElementById('explorarRestaurante').value;
  let ciudadSel = document.getElementById('explorarCiudad').value;
  let paisSel = document.getElementById('explorarPais').value;
  let usuarioSel = document.getElementById('explorarUsuario').value;
  let html = '';
  let filtradas = visitas.filter(v => {
    let rOk = restauranteSel === 'todos' || v.restaurante === restauranteSel;
    let cOk = ciudadSel === 'todos' || normalize(v.ciudad) === normalize(ciudadSel);
    let pOk = paisSel === 'todos' || normalize(v.pais) === normalize(paisSel);
    let uOk = usuarioSel === 'todos' || v.usuario === usuarioSel;
    return rOk && cOk && pOk && uOk;
  });

  // Si no hay filtros, mostrar top 10 de los 10 usuarios mÃ¡s activos
  if (restauranteSel === 'todos' && ciudadSel === 'todos' && paisSel === 'todos' && usuarioSel === 'todos') {
    let topUsers = getTopActiveUsers(visitas, 10);
    let topRestaurantes = getTopRatedRestaurants(visitas, topUsers, 10);
    filtradas = [];
    topRestaurantes.forEach(grupo => {
      filtradas = filtradas.concat(
        visitas.filter(v =>
          v.restaurante === grupo.nombre &&
          normalize(v.ciudad) === normalize(grupo.ciudad) &&
          normalize(v.pais) === normalize(grupo.pais) &&
          topUsers.includes(v.usuario)
        )
      );
    });
  }

  let agrupados = {};
  filtradas.forEach(v => {
    const key = v.restaurante + '|' + normalize(v.ciudad) + '|' + normalize(v.pais);
    if (!agrupados[key]) agrupados[key] = { nombre: v.restaurante, ciudad: v.ciudad, pais: v.pais, moneda: v.moneda, precios: [], valoraciones: [], reseÃ±as: [], visitas: 0 };
    agrupados[key].precios.push(v.total / v.comensales);
    agrupados[key].valoraciones.push(v.valoracion);
    agrupados[key].reseÃ±as.push({ usuario: v.usuario, reseÃ±a: v.reseÃ±a });
    agrupados[key].visitas += 1;
  });
  Object.values(agrupados).forEach(grupo => {
    let precioMedio = grupo.precios.length ? (grupo.precios.reduce((a,b)=>a+b,0)/grupo.precios.length).toFixed(2) : '0.00';
    let valoracionMedia = grupo.valoraciones.length ? (grupo.valoraciones.reduce((a,b)=>a+b,0)/grupo.valoraciones.length).toFixed(1) : '0';
    let mapsLink = `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(grupo.nombre + ' ' + grupo.ciudad + ' ' + grupo.pais)}" target="_blank" style="color:#00eaff;">Google Maps</a>`;
    html += `<div class="card">
      <div class="restaurante-nombre">${grupo.nombre}</div>
      <div>${textos[lang].lblPais.split(':')[0]}: ${grupo.pais}</div>
      <div>${textos[lang].lblCiudad.split(':')[0]}: ${grupo.ciudad}</div>
      <div><b>NÃºmero de visitas:</b> ${grupo.visitas}</div>
      <div>${textos[lang].lblAvgPrice.split(':')[0]}: <b>${precioMedio} ${grupo.moneda}</b></div>
      <div>${textos[lang].lblValoracion.split(':')[0]}: <span class="stars">${'â˜…'.repeat(Math.round(valoracionMedia))}${'â˜†'.repeat(5-Math.round(valoracionMedia))}</span> (${valoracionMedia})</div>
      <div><b>${textos[lang].lblReseÃ±a.split(':')[0]}:</b><ul class="review-list">${grupo.reseÃ±as.map(r=>`<li><span class="usuario-nombre">${r.usuario}</span>: ${r.reseÃ±a}</li>`).join('')}</ul></div>
      ${mapsLink}
    </div>`;
  });
  document.getElementById('explorarCards').innerHTML = html;
}

function renderAmigosResumen() {
  let lang = document.getElementById('lang').value;
  let usuarioSel = document.getElementById('amigosUsuario').value;
  let ciudadSel = document.getElementById('amigosCiudad').value;
  let paisSel = document.getElementById('amigosPais').value;
  let html = '';
  let filtradas = visitas.filter(v => {
    let uOk = usuarioSel === 'todos' || v.usuario === usuarioSel;
    let cOk = ciudadSel === 'todos' || normalize(v.ciudad) === normalize(ciudadSel);
    let pOk = paisSel === 'todos' || normalize(v.pais) === normalize(paisSel);
    return uOk && cOk && pOk;
  });

  // Si no hay filtros, mostrar top 10 de los 10 usuarios mÃ¡s activos
  if (usuarioSel === 'todos' && ciudadSel === 'todos' && paisSel === 'todos') {
    let topUsers = getTopActiveUsers(visitas, 10);
    let topRestaurantes = getTopRatedRestaurants(visitas, topUsers, 10);
    filtradas = [];
    topRestaurantes.forEach(grupo => {
      filtradas = filtradas.concat(
        visitas.filter(v =>
          v.restaurante === grupo.nombre &&
          normalize(v.ciudad) === normalize(grupo.ciudad) &&
          normalize(v.pais) === normalize(grupo.pais) &&
          topUsers.includes(v.usuario)
        )
      );
    });
  }

  let agrupados = {};
  filtradas.forEach(v => {
    const key = v.restaurante + '|' + normalize(v.ciudad) + '|' + normalize(v.pais);
    if (!agrupados[key]) agrupados[key] = { nombre: v.restaurante, ciudad: v.ciudad, pais: v.pais, moneda: v.moneda, precios: [], valoraciones: [], reseÃ±as: [], visitas: 0 };
    agrupados[key].precios.push(v.total / v.comensales);
    agrupados[key].valoraciones.push(v.valoracion);
    agrupados[key].reseÃ±as.push({ usuario: v.usuario, reseÃ±a: v.reseÃ±a });
    agrupados[key].visitas += 1;
  });
  Object.values(agrupados).forEach(grupo => {
    let precioMedio = grupo.precios.length ? (grupo.precios.reduce((a,b)=>a+b,0)/grupo.precios.length).toFixed(2) : '0.00';
    let valoracionMedia = grupo.valoraciones.length ? (grupo.valoraciones.reduce((a,b)=>a+b,0)/grupo.valoraciones.length).toFixed(1) : '0';
    let mapsLink = `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(grupo.nombre + ' ' + grupo.ciudad + ' ' + grupo.pais)}" target="_blank" style="color:#00eaff;">Google Maps</a>`;
    html += `<div class="card">
      <div class="restaurante-nombre">${grupo.nombre}</div>
      <div>${textos[lang].lblPais.split(':')[0]}: ${grupo.pais}</div>
      <div>${textos[lang].lblCiudad.split(':')[0]}: ${grupo.ciudad}</div>
      <div><b>NÃºmero de visitas:</b> ${grupo.visitas}</div>
      <div>${textos[lang].lblAvgPrice.split(':')[0]}: <b>${precioMedio} ${grupo.moneda}</b></div>
      <div>${textos[lang].lblValoracion.split(':')[0]}: <span class="stars">${'â˜…'.repeat(Math.round(valoracionMedia))}${'â˜†'.repeat(5-Math.round(valoracionMedia))}</span> (${valoracionMedia})</div>
      <div><b>${textos[lang].lblReseÃ±a.split(':')[0]}:</b><ul class="review-list">${grupo.reseÃ±as.map(r=>`<li><span class="usuario-nombre">${r.usuario}</span>: ${r.reseÃ±a}</li>`).join('')}</ul></div>
      ${mapsLink}
    </div>`;
  });
  document.getElementById('amigosCards').innerHTML = html;
}
document.getElementById('amigosUsuario').onchange = renderAmigosResumen;
document.getElementById('amigosCiudad').onchange = renderAmigosResumen;
document.getElementById('amigosPais').onchange = renderAmigosResumen;

// InicializaciÃ³n
initLangTheme();
setLang();
document.getElementById('lang').onchange = setLang;
document.getElementById('theme').onchange = setTheme;

document.getElementById('explorarPais').onchange = renderExplorar;
document.getElementById('explorarCiudad').onchange = renderExplorar;
document.getElementById('explorarRestaurante').onchange = renderExplorar;
document.getElementById('explorarUsuario').onchange = renderExplorar;
document.getElementById('histRest').onchange = renderHistorial;
document.getElementById('histPais').onchange = renderHistorial;
document.getElementById('histCiudad').onchange = renderHistorial;
document.getElementById('histRest').onchange = function() {
  document.getElementById('histPais').value = 'todos';
  document.getElementById('histCiudad').value = 'todos';
  renderHistorial();
};
document.getElementById('histPais').onchange = function() {
  document.getElementById('histRest').value = 'todos';
  document.getElementById('histCiudad').value = 'todos';
  renderHistorial();
};
document.getElementById('histCiudad').onchange = function() {
  document.getElementById('histRest').value = 'todos';
  document.getElementById('histPais').value = 'todos';
  renderHistorial();
};
function mostrarRegistroSiNecesario() {
  if (!localStorage.getItem('usuarioRegistrado')) {
    document.getElementById('registroModal').style.display = 'flex';
  }
}
document.getElementById('registroForm').onsubmit = function(e) {
  e.preventDefault();
  let email = document.getElementById('regEmail').value.trim();
  let password = document.getElementById('regPassword').value.trim();
  let username = document.getElementById('regUsername').value.trim();
  // Comprobar que el nombre de usuario es Ãºnico
  let yaExiste = usuarios.includes(username);
  if (yaExiste) {
    document.getElementById('regMsg').innerText = 'El nombre de usuario ya existe. Elige otro.';
    return;
  }
  if (!email || !password || !username) {
    document.getElementById('regMsg').innerText = 'Completa todos los campos.';
    return;
  }
  usuarios.push(username);
  localStorage.setItem('usuarioRegistrado', JSON.stringify({ email, username }));
  document.getElementById('registroModal').style.display = 'none';
  document.getElementById('regMsg').innerText = '';
  setLang();
};
window.onload = mostrarRegistroSiNecesario;
function seleccionarUsuarioRegistrado() {
  const reg = localStorage.getItem('usuarioRegistrado');
  if (reg) {
    const { username } = JSON.parse(reg);
    // Selecciona el usuario en los desplegables
    const selects = [
      'explorarUsuario',
      'amigosUsuario'
    ];
    selects.forEach(id => {
      const sel = document.getElementById(id);
      if (sel && [...sel.options].some(opt => opt.value === username || opt.text === username)) {
        sel.value = username;
      }
    });
  }
}
window.onload = function() {
  mostrarRegistroSiNecesario();
  seleccionarUsuarioRegistrado();
};
function mostrarTicket(src) {
  document.getElementById('ticketImg').src = src;
  document.getElementById('ticketModal').style.display = 'flex';
}
document.getElementById('resumenRest').onchange = renderResumen;
document.getElementById('resumenPais').onchange = renderResumen;
document.getElementById('resumenCiudad').onchange = renderResumen;
</script>
